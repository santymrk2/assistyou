---
// src/pages/tables.astro
// Importamos la función de autenticación y la función para realizar consultas a la base de datos.
import { getSession } from "auth-astro/server";
/* import { queryDB } from "astro:db";
 */
// Obtenemos el usuario a partir de la request (esto depende de cómo implementes auth.js)
const user = await getSession(Astro.request);
if (!user) {
    // Si no hay usuario, podrías redirigir o lanzar un error
    throw new Error("Usuario no autenticado");
} else {
    // Si hay usuario, puedes realizar las consultas a la base de datos
    console.log("Usuario autenticado:", user);
}

// Realizamos las consultas filtrando por user_id
/* const [schools, courses, students, semesterPeriods, attendances, exams] =
    await Promise.all([
        queryDB("SELECT * FROM School WHERE user_id = ?", [user.id]),
        queryDB("SELECT * FROM Course WHERE user_id = ?", [user.id]),
        queryDB("SELECT * FROM Student WHERE user_id = ?", [user.id]),
        queryDB("SELECT * FROM SemesterPeriod WHERE user_id = ?", [user.id]),
        queryDB("SELECT * FROM Attendance WHERE user_id = ?", [user.id]),
        queryDB("SELECT * FROM Exam WHERE user_id = ?", [user.id]),
    ]);
 */
// Puedes también realizar las consultas para las tablas puente si lo requieres, aplicando el mismo filtro.
---

<html>
    <head>
        <title>Datos filtrados por usuario</title>
    </head>
    <body>
<!--         <h1>Bienvenido {user}</h1>

        <section>
            <h2>Escuelas</h2>
            <pre>{JSON.stringify(schools, null, 2)}</pre>
        </section>

        <section>
            <h2>Cursos</h2>
            <pre>{JSON.stringify(courses, null, 2)}</pre>
        </section>

        <section>
            <h2>Estudiantes</h2>
            <pre>{JSON.stringify(students, null, 2)}</pre>
        </section>

        <section>
            <h2>Cuatrimestres</h2>
            <pre>{JSON.stringify(semesterPeriods, null, 2)}</pre>
        </section>

        <section>
            <h2>Asistencias</h2>
            <pre>{JSON.stringify(attendances, null, 2)}</pre>
        </section>

        <section>
            <h2>Exámenes</h2>
            <pre>{JSON.stringify(exams, null, 2)}</pre>
        </section>
 -->    </body>
</html>
