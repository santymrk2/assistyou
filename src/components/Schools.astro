---
const { schools } = Astro.props

export const prerender = false;
---

<div class="flex flex-col items-center">
    <div class="flex justify-between items-center w-full md:max-w-xl max-w-2xl mb-6">
        <h1 class="text-center text-2xl font-black text-white">Schools</h1>
        <button 
            id="addSchool"
            class="bg-orange-600 hover:bg-orange-700 text-white font-bold mx-4 rounded-lg transition-colors"
        >
        <svg
        class="stroke-2 stroke-white size-8 group-hover:stroke-zinc-700"
        viewBox="0 0 24 24"
        fill="none"
        xmlns="http://www.w3.org/2000/svg"
      >
        <path
          d="M7 12h5m0 0h5m-5 0V7m0 5v5"
          stroke-linecap="round"
          stroke-linejoin="round"
        />
      </svg>
</button>
    </div>
    
    <div class="flex flex-col sm:flex-row gap-4 flex-wrap justify-center">
        {
            schools.map(({id, name}) => (
                <div class="bg-orange-600 hover:bg-orange-700 rounded-xl flex flex-col items-center">
                    <a href={`/schools/${id}`} class="text-zinc-900 text-lg font-extrabold text-center px-6 py-4">{name}</a>
                </div>
            ))
        }
    </div>

    <!-- Modal para añadir escuela -->
    <div id="schoolModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
        <div class="bg-white dark:bg-zinc-800 p-6 rounded-xl w-full max-w-md">
            <h2 class="text-xl font-bold mb-4 dark:text-white">Añadir Nueva Escuela</h2>
            <form id="schoolForm" class="flex flex-col gap-4">
                <div>
                    <label for="schoolName" class="block mb-2 dark:text-white">Nombre de la Escuela</label>
                    <input 
                        type="text" 
                        id="schoolName" 
                        class="w-full p-2 border rounded-lg dark:bg-zinc-700 dark:text-white dark:border-zinc-600" 
                        required
                    />
                </div>
                <div class="flex justify-end gap-2 mt-4">
                    <button 
                        type="button" 
                        id="cancelSchool"
                        class="px-4 py-2 border rounded-lg hover:bg-zinc-100 dark:hover:bg-zinc-700 dark:text-white transition-colors"
                    >
                        Cancelar
                    </button>
                    <button 
                        type="submit"
                        class="px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700 transition-colors"
                    >
                        Guardar
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    import { $ } from "../lib/dom-selector";
    
    const $addSchool = $("#addSchool");
    const $schoolModal = $("#schoolModal");
    const $cancelSchool = $("#cancelSchool");
    const $schoolForm = $("#schoolForm");
    
    // Mostrar modal
    if ($addSchool) {
        $addSchool.onclick = () => {
            $schoolModal.classList.remove("hidden");
        };
    }
    
    // Ocultar modal
    if ($cancelSchool) {
        $cancelSchool.onclick = () => {
            $schoolModal.classList.add("hidden");
        };
    }
    
    // Enviar formulario
    if ($schoolForm) {
        $schoolForm.onsubmit = async (e) => {
            e.preventDefault();
            
            const schoolName = ($("#schoolName") as HTMLInputElement).value;
            
            if (!schoolName) return;
            
            try {
                const response = await fetch('/api/schools', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ name: schoolName })
                });
                
                if (response.ok) {
                    // Recargar la página para mostrar la nueva escuela
                    window.location.reload();
                } else {
                    console.error('Error al crear la escuela');
                }
            } catch (error) {
                console.error('Error:', error);
            }
        };
    }
</script>